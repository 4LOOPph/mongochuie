"use strict";angular.module("account",["ngRoute","ui.bootstrap","bbc.transport","bbc.session","pascalprecht.translate","tmh.dynamicLocale","bbc.cache","bbc.form","bbc.match","account.register","account.password","account.username","account.login"]).config(["$routeProvider","$locationProvider","$translateProvider","$bbcTransportProvider","tmhDynamicLocaleProvider",function(a,b,c,d,e){a.otherwise({redirectTo:"/account/login"}),b.html5Mode(!0),d.set({useSocket:!1}),e.localeLocationPattern("assets/bower_components/angular-i18n/angular-locale_{{locale}}.js"),c.useStaticFilesLoader({prefix:"/locale/account/locale-",suffix:".json"}),c.preferredLanguage("en-us"),c.fallbackLanguage("en-us")}]).run(["$rootScope","$translate","tmhDynamicLocale","$log","$window","$bbcSession",function(a,b,c,d,e,f){a.currentLang=b.preferredLanguage(),a.switchLocale=function(c){b.use(c),a.currentLang=c},a.requestNeeded=!1,a.$on("$routeChangeStart",function(b,c){f.setActivity(function(b){b&&(d.warn(b),a.$emit("$sessionInactive"))}),a.requestNeeded&&e.location.assign(c.$$route.originalPath)}),a.$on("$sessionInactive",function(){d.warn("next route change event triggers a server request."),a.requestNeeded=!0}),a.$on("$translateChangeSuccess",function(){c.set(b.use())})}]),angular.module("account.register",[]).config(["$routeProvider",function(a){a.when("/account/register",{templateUrl:"app/account/register/register.html",controller:"AccountRegisterCtrl"})}]).controller("AccountRegisterCtrl",["$scope","$bbcTransport","$translate",function(a,b,c){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.register=function(){a.form&&!a.form.$valid||(a.form&&(a.form.errors={}),a.user.language=c.use(),b.emit("api/account/register",a.user,function(b,c){if(a.alerts.length=0,!b&&c)a.alerts.push({type:"success",msg:"REGISTER_MSG"}),a.user={},a.form.$setPristine();else if("ValidationError"===b.name)for(var d=0;d<b.errors.length;d++)a.form.errors[b.errors[d].property]=b.errors[d].attribute.toUpperCase();else a.alerts.push({type:"danger",msg:"GENERIC_ERROR"})}))}}]),angular.module("account.password",[]).config(["$routeProvider",function(a){a.when("/account/password",{templateUrl:"app/account/password/password.html",controller:"AccountPasswordCtrl"})}]).controller("AccountPasswordCtrl",["$scope","$bbcTransport","$translate",function(a,b,c){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.send=function(){a.form&&!a.form.$valid||(a.form&&(a.form.errors={}),a.user.language=c.use(),b.emit("api/account/resetPassword",a.user,function(b,c){if(a.alerts.length=0,!b&&c)a.alerts.push({type:"success",msg:"RESET_PASSWORD_MSG"}),a.user={},a.form.$setPristine();else if("ValidationError"===b.name)for(var d=0;d<b.errors.length;d++)a.form.errors[b.errors[d].property]=b.errors[d].attribute.toUpperCase();else a.alerts.push({type:"danger",msg:"GENERIC_ERROR"})}))}}]),angular.module("account.username",[]).config(["$routeProvider",function(a){a.when("/account/username",{templateUrl:"app/account/username/username.html",controller:"AccountUsernameCtrl"})}]).controller("AccountUsernameCtrl",["$scope","$bbcTransport","$translate",function(a,b,c){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.send=function(){a.form&&!a.form.$valid||(a.form&&(a.form.errors={}),a.user.language=c.use(),b.emit("api/account/forgotUsername",a.user,function(b,c){if(a.alerts.length=0,!b&&c)a.alerts.push({type:"success",msg:"USERNAME_MSG"}),a.user={},a.form.$setPristine();else if("ValidationError"===b.name)for(var d=0;d<b.errors.length;d++)a.form.errors[b.errors[d].property]=b.errors[d].attribute.toUpperCase();else a.alerts.push({type:"danger",msg:"GENERIC_ERROR"})}))}}]),angular.module("account.login",[]).config(["$routeProvider",function(a){a.when("/account/login",{templateUrl:"app/account/login/login.html",controller:"AccountLoginCtrl"})}]).controller("AccountLoginCtrl",["$scope","$bbcForm","$bbcTransport","$translate","$log","$window",function(a,b,c,d,e,f){a.$bbcForm=b("accountLoginCtrl","_id"),a.user={},a.authFailed=!1,a.authError=!1,a.guestError=!1,a.login=function(){a.form&&(a.form.errors={}),c.rest("api/auth/login",{user:a.user},function(b,c){!b&&c?f.location.href="/":(403===b.status?a.authFailed=!0:400===b.status?a.guestError=!0:a.authError=!0,e.error(b))})}}]);