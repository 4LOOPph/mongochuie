"use strict";angular.module("main",["ngRoute","ui.bootstrap","bbc.transport","bbc.navigation","bbc.session","bbc.pager","bbc.sort","bbc.cache","bbc.form","bbc.reset","bbc.float","bbc.integer","bbc.modal","bbc.alert","bbc.inline.edit","bbc.checkbox","bbc.radio","pascalprecht.translate","tmh.dynamicLocale","colorpicker.module","common.focus","common.fileDrop","common.auth","common.settings","common.codemirror","common.contextmenu","common.scrollframe","main.dev"]).config(["$routeProvider","$locationProvider","$bbcNavigationProvider","$translateProvider","tmhDynamicLocaleProvider","$bbcTransportProvider","$compileProvider",function(a,b,c,d,e,f,g){g.debugInfoEnabled(!0),a.otherwise({redirectTo:"/"}),b.html5Mode(!0),c.set({app:"main",route:"/"}),f.set({socketResponseTimeout:6e4}),e.localeLocationPattern("assets/bower_components/angular-i18n/angular-locale_{{locale}}.js"),d.useStaticFilesLoader({prefix:"/locale/main/locale-",suffix:".json"}),d.preferredLanguage("en-us"),d.fallbackLanguage("en-us")}]).run(["$rootScope","$translate","tmhDynamicLocale","$log","$window","$bbcSession","$bbcAlert","$bbcNavigation",function(a,b,c,d,e,f,g,h){function i(){navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/BB/i)||navigator.userAgent.match(/PlayBook/i)||navigator.userAgent.match(/Windows Phone/i)?a.checkAgent=!0:a.checkAgent=!1}a.bbcAlert=g,a.currentLang=b.preferredLanguage(),a.switchLocale=function(c){b.use(c),a.currentLang=c},a.requestNeeded=!1,a.$on("$routeChangeStart",function(b,c){f.setActivity(function(b){b&&(d.warn(b),a.$emit("$sessionInactive"))}),a.requestNeeded&&e.location.assign(c.$$route.originalPath)}),a.$on("$sessionInactive",function(){d.warn("next route change event triggers a server request."),a.requestNeeded=!0}),a.$on("$translateChangeSuccess",function(){c.set(b.use())}),h.getTree(function(b,c){a.navigation=c||[]}),f.getUserDataForClient(function(b,c){c&&(a.rightSystem=c.rightssystem)}),a.checkAgent=!1,i()}]),angular.module("main.dev",["main.dev.modals"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/main/dev/dev.html",controller:"MainDevCtrl",app:"main"})}]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){return 40!==b.which||b.shiftKey||b.ctrlKey||b.altKey||b.altGraphKey||b.metaKey?38!==b.which||b.shiftKey||b.ctrlKey||b.altKey||b.altGraphKey||b.metaKey?13===b.which?(a.$apply(function(){a.$eval(c.ngEnter),console.log(a.tab.mongoshell.cmds)}),b.preventDefault()):void 0:(a.tab.mongoshell.cmds.index=Math.max(--a.tab.mongoshell.cmds.index,0),a.tab.input=a.tab.mongoshell.cmds.list[a.tab.mongoshell.cmds.index]||"",a.$apply(function(){a.showSelectCommandFromList(a.tab)}),b.preventDefault()):(a.tab.mongoshell.cmds.index=Math.min(++a.tab.mongoshell.cmds.index,a.tab.mongoshell.cmds.list.length),a.tab.input=a.tab.mongoshell.cmds.list[a.tab.mongoshell.cmds.index]||"",a.$apply(function(){a.showSelectCommandFromList(a.tab)}),b.preventDefault())})}}).controller("MainDevCtrl",["$scope","$modal","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$bbcModal","$translate","THEMES","$rootScope","VIEWS","mmsUtils","REGEX_SYSTEM_AND_CHUNKS_COLLECTION_NAMES","TYPE_STYLES","$window","DEFAULT_PAGE_SIZE",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){var b=[{filter:/ObjectId\("(.*?)"\)/gi,replacewith:'"ObjectId($1)"'},{filter:/ISODate\("(.*?)"\)/gi,replacewith:'"ISODate($1)"'},{filter:/NumberLong\((.*?)\)/gi,replacewith:"$1"},{filter:/NumberInt\((.*?)\)/gi,replacewith:"$1"},{filter:/BinData\([0-9],(.*?)\)/gi,replacewith:"$1"},{filter:/Timestamp\((.*?)\)/gi,replacewith:'"Timestamp($1)"'}];try{return b.forEach(function(b){a=a.replace(b.filter,b.replacewith)}),JSON.parse(a)}catch(c){return console.error(c),a}}function p(a){return a.replace("ObjectId(","").replace(")","")}function q(a){return a.replace("ISODate(","").replace(")","")}function r(a){return a.replace("UUID(","").replace(")","")}function s(a){return a.replace("LUUID(","").replace(")","")}function t(a){var b={},c={},d=!1;return angular.forEach(a.members,function(b){b.self&&(c={current:b.stateStr+" (_id: "+b._id+")",members:a.members.map(function(a){return{_id:a._id,name:a.name,health:a.health,stateStr:a.stateStr}})},d="PRIMARY"!==b.stateStr.toUpperCase(),c=JSON.stringify(c,null,"	"),c=c.slice(1,c.length-1))}),b.titleOfReplicaSet=c.replace(/\t"([a-zA-Z_]+)":/g,"$1:").replace(/\[/g,"").replace(/\]/g,"").replace(/\t\t/g,"	"),b.isSlave=d,b}function u(b){b=b||{},a.codeTheme.find=b.theme_find||a.codeTheme.find,a.codeTheme.serversidescript=b.theme_console||a.codeTheme.serversidescript,"boolean"==typeof b.setIsEnabled&&(a.setIsEnabled=b.setIsEnabled),b.language&&b.language.code&&h.switchLocale(b.language.code),b.default_view&&(a.documentView=b.default_view),a.defaultPageSize=b.default_page_size||n,a.defaultMongoDbPort=b.default_mongodb_port}function v(a,b){return a.name>b.name?1:-1}function w(b){c.emit(d+"main/getServerInformations",b,function(c,d){if(d){var e=d.replSetStat&&1===d.replSetStat.ok?t(d.replSetStat):null,g={connectionString:x(d.connectionString,"slave_ok",Boolean(d.slave_ok)),showDatabases:!0,databases:d.databases||[],color:b.connection.color||"#ff4800",titleOfReplicaSetConnection:e?e.titleOfReplicaSet:null,master:d.master,replSetStat:d.replSetStat,replSetName:d.replSetStat&&1===d.replSetStat.ok?d.replSetStat.set:null,login_database:d.login_database||b.connection.login_database,dbName:b.connection.dbName,mongoVersion:d.mongoVersion,isSlave:e?e.isSlave:!1,login:d.login,password:d.password};g.displayName=g.replSetName?"Replica-set: '"+g.replSetName+"'":d.master.server+": "+d.master.port,g.titleOfReplicaSetConnection=g.titleOfReplicaSetConnection||d.connectionTitle,b.connection.name&&(g.displayName=b.connection.name),a.connections.push(g),d.error&&f("ERROR_SAVING_SERVER_CONNECTION").then(function(b){a.serverError=b})}else c&&f("ERROR_SERVER_CONNECTION",{errormessage:c.message}).then(function(a){h.bbcAlert.danger(a)})})}function x(a,b,c){return a+=a.indexOf("?")>0?"&":"?",a+=b+"="+c}function y(b){var c={};return c=lxvalid.types.object(b).valid||"object"===b?a.typeStyles.type_object:lxvalid.types.array(b).valid||"array"===b?a.typeStyles.type_array:"string"===b?a.typeStyles.type_string:"ObjectID"===b?a.typeStyles.type_objectId:"date-time"===b?a.typeStyles.type_date_time:"integer"===b||"float"===b||"number"===b?a.typeStyles.type_number:"null"===b?a.typeStyles.type_null:"boolean"===b?a.typeStyles.type_boolean:"regex"===b?a.typeStyles.type_regex:"UUID"===b?a.typeStyles.type_uuid:"LUUID"===b?a.typeStyles.type_luuid:"Timestamp"===b?a.typeStyles.type_timestamp:"DBRef"===b?a.typeStyles.type_dbref:"Code"===b?a.typeStyles.type_code:"MinKey"===b?a.typeStyles.type_minkey:"MaxKey"===b?a.typeStyles.type_maxkey:a.typeStyles.type_null}function z(a){return a.replace(/\\([SsvdDBwW]+)/g,"\\\\$1")}function A(a){var b=a;return a=a.replace(/([:,\[]*)([\s]*)"##\/([a-zA-Z0-9À-Üß-ü$\^+*\-\._:'()|\\\/ ]+)\/([a-z]*)"/g,"$1$2/$3/$4"),b!==a&&(a=a.replace(/([:,\[]*)([\s]*)\/(.*?)\\\\([SsvdDBwW]+)/g,"$1$2/$3\\$4")),a}function B(a){var b=JSON.stringify(a.substr(0,a.match(/\/([a-z]*)$/).index).replace(/\##\//g,"")).replace(/"/g,"").replace(/\\\\([SsvdDBwW]+)/g,"\\$1"),c=a.substr(a.match(/\/([a-z]*)$/).index+1);return A(new RegExp(b,c).toString())}function C(a,b,c){var d={key:a,value:b,isExpanded:!1,hasItems:!lxHelpers.isEmpty(b),style:y(c?c:lxHelpers.getType(b))};if(null===b)return d.valueAsJSON="NULL",d;if(lxHelpers.isString(b)&&("ObjectID"===c||!c&&-1!==b.indexOf("ObjectId")))d.hasItems=!0,d.valueAsJSON='ObjectId("'+p(b)+'")',d.isObjectID=!0,d.style="ObjectID"===c?d.style:y("ObjectID");else if(lxHelpers.isString(b)&&("date-time"===c||"date"===c||!c&&-1!==b.indexOf("ISODate"))){var e=new Date(q(b));d.valueAsJSON=j.getFormattedDate(e,f.instant("DATETIME_FORMATS.OBJECTID"));try{d.title=e.toISOString()}catch(g){d.title=q(b).toString(),d.valueAsJSON=q(b).toString()}d.style="date-time"===c?d.style:y("date-time")}else lxHelpers.isString(b)&&("regex"===c||!c&&-1!==b.indexOf("##/"))?(d.valueAsJSON=B(b),d.style=y(c&&"regex"===c?c:"regex")):lxHelpers.isString(b)&&("UUID"===c||!c&&-1!==b.indexOf("UUID")&&-1===b.indexOf("LUUID"))?(d.valueAsJSON='UUID("'+r(b)+'")',d.style=y(c&&"UUID"===c?c:"UUID")):lxHelpers.isString(b)&&("LUUID"===c||!c&&-1!==b.indexOf("LUUID"))?(d.valueAsJSON='LUUID("'+s(b)+'")',d.style=y(c&&"LUUID"===c?c:"LUUID")):lxHelpers.isObject(b)&&("Code"===c||!c&&b.$scope&&b.$code)?(d.hasItems=!0,d.isCode=!0,d.valueAsJSON=b,d.style=y(c&&"Code"===c?c:"Code")):lxHelpers.isString(b)&&("Timestamp"===c||!c&&-1!==b.indexOf("Timestamp"))?(d.valueAsJSON=b,d.style=y(c&&"Timestamp"===c?c:"Timestamp")):lxHelpers.isString(b)?d.valueAsJSON='"'+b.replace(/\\/g,"\\\\")+'"':d.valueAsJSON=A(JSON.stringify(b));return(lxHelpers.isObject(c)||lxHelpers.isArray(c))&&(d.metadata=c),d}function D(a,b){for(var c={},d=lxHelpers.isObject(a)?Object.keys(a):[],e=0,g=d.length;g>e;e++){var h=d[e],i=a[h],k=b?b[h]:null,l={style:y(k?k:lxHelpers.getType(i))};if(null!==i){if(lxHelpers.isString(i)&&("ObjectID"===k||!k&&-1!==i.indexOf("ObjectId")))l.valueAsJSON='ObjectId("'+p(i)+'")',l.style=y(k&&"ObjectID"===k?k:"ObjectID");else if(lxHelpers.isString(i)&&("date-time"===k||"date"===k||!k&&-1!==i.indexOf("ISODate"))){var m=new Date(q(i));l.valueAsJSON=j.getFormattedDate(m,f.instant("DATETIME_FORMATS.OBJECTID"));try{l.title=m.toISOString()}catch(n){l.title=q(i).toString(),l.valueAsJSON=q(i).toString()}l.style=y(k&&"date-time"===k?k:"date-time")}else if(lxHelpers.isString(i)&&("regex"===k||!k&&-1!==i.indexOf("##/")))l.valueAsJSON=B(i),l.style=y(k&&"regex"===k?k:"regex");else if(lxHelpers.isString(i)&&("UUID"===k||!k&&-1!==i.indexOf("UUID")&&-1===i.indexOf("LUUID")))l.valueAsJSON='UUID("'+r(i)+'")',l.style=y(k&&"UUID"===k?k:"UUID");else if(lxHelpers.isString(i)&&("LUUID"===k||!k&&-1!==i.indexOf("LUUID")))l.valueAsJSON='LUUID("'+s(i)+'")',l.style=y(k&&"LUUID"===k?k:"LUUID");else if(lxHelpers.isString(i)&&("Timestamp"===k||!k&&-1!==i.indexOf("Timestamp")))l.valueAsJSON=i,l.style=y(k&&"Timestamp"===k?k:"Timestamp");else if(lxHelpers.isString(i)&&"date-time"!==k&&"ObjectID"!==k&&"regex"!==k)l.valueAsJSON='"'+i.replace(/\\/g,"\\\\")+'"',l.style=y("string");else if(lxHelpers.isObject(i))l.valueAsJSON="Object {"+N(i)+"}",l.style=y(k),l.title=i;else if(lxHelpers.isArray(i)){l.valueAsJSON="Array ["+N(i)+"]",l.style=y(k);var o=[];lxHelpers.forEach(i,function(a){lxHelpers.isString(a)&&k&&"regex"===k[i.indexOf(a)]&&(a=B(a)),o.push(a)}),l.title=o}else l.valueAsJSON=lxHelpers.isBoolean(i)||0===i?JSON.stringify(i):i;c[h]=l}else l.valueAsJSON="NULL",c[h]=l}return c}function E(a,b){for(var c=[],d=Object.keys(a),e=0,f=d.length;f>e;e++){var g=d[e],h=a[g],i=b?b[g]:null;c.push(C(g,h,i))}return c}function F(a,b){c.emit(d+"main/getAll",a,function(a,c){c?(b.count=c.count,b.metadata=c.metadata||{},b.documents.$selectCount=0,b.documents.$isAllSelected=!1,b.executedInput=b.input,M(c.items,b,c.metadata),b.isSelectedQueryParam="find"):a&&(b.documents={$selectCount:0},h.bbcAlert.danger(a.message))})}function G(a,b){c.emit(d+"main/executeScript",a,function(a,c){var d=[];a&&(h.bbcAlert.danger(a.message||a),d.push({errormessage:a.message||a})),c&&(b.executedInput=b.input,c.retval?c.retval instanceof Array&&0!==c.retval.length?d=c.retval.slice():0===c.retval.length||0===Object.keys(c.retval).length?(c.retval={ok:!0},d.push(c.retval)):d.push(c.retval):d.push(c),c.errmsg&&h.bbcAlert.danger(c.errmsg),c.message&&f(c.message).then(function(a){h.bbcAlert.danger(a)})),d&&(b.metadata={},M(d,b),b.isSelectedQueryParam="serversidescript")})}function H(a,b){for(var c=b||[],d=0,e=a.length;e>d;d++){var f=a[d];if(angular.isString(f)&&0===c.length)c.push(d);else for(var g=lxHelpers.isObject(f)?Object.keys(f):[],h=0,i=g.length;i>h;h++)-1===c.indexOf(g[h])&&c.push(g[h])}return c}function I(a,b){var c,d=[];b=b||{};for(var e=0,f=a.length;f>e;e++){var g=a[e],h={documentAsJSON:A(JSON.stringify(g)),isExpanded:!1,isExpandable:lxHelpers.isObject(g)};if(c=null,g){var i=lxHelpers.isString(g._id)?p(g._id):g._id;h.id=i,h._id=lxvalid.types.mongoId(i).valid?{$oid:i}:g._id,c=b[i]}h.properties=lxHelpers.isObject(g)?E(g,c):void 0,d.push(h)}return d}function J(a,b){var c,d=[];b=b||{};for(var e=0,f=a.length;f>e;e++){var g,h=a[e];c=null,h&&(g=lxHelpers.isString(h._id)?p(h._id):h._id,c=b[g]);var i={data:lxHelpers.isObject(h)?D(h,b?c:null):{valueAsJSON:lxHelpers.isBoolean(h)||0===h||null===h?JSON.stringify(h):h},id:g};d.push(i)}return d}function K(a,b){var c;if("ObjectID"===b||!b&&lxHelpers.isString(a)&&-1!==a.indexOf("ObjectId"))c='##ObjectId("'+p(a)+'")';else if("date-time"===b||"date"===b||!b&&lxHelpers.isString(a)&&-1!==a.indexOf("ISODate"))c="##"+a;else if("UUID"===b||!b&&lxHelpers.isString(a)&&-1!==a.indexOf("UUID")&&-1===a.indexOf("LUUID"))c='##UUID("'+r(a)+'")';else if("LUUID"===b||!b&&lxHelpers.isString(a)&&-1!==a.indexOf("LUUID"))c='##LUUID("'+s(a)+'")';else if("Timestamp"===b||!b&&lxHelpers.isString(a)&&-1!==a.indexOf("Timestamp"))c="##"+a;else if(lxHelpers.isArray(a))c=[],a.map(function(d){c.push(K(d,b?b[a.indexOf(d)]:null))});else if(lxHelpers.isObject(a)){var d;c={};for(d in a)a.hasOwnProperty(d)&&(c[d]=K(a[d],b?b[d]:null))}else c=a;return c}function L(a,b){for(var c=[],d=function(a){var b;return b=JSON.stringify(a,null,"	"),b=b.replace(/"##ObjectId\(\\"([a-z0-9]*)\\"\)"/g,"ObjectId('$1')"),b=b.replace(/"##UUID\(\\"([a-z0-9-]*)\\"\)"/g,"UUID('$1')"),b=b.replace(/"##LUUID\(\\"([a-z0-9-]*)\\"\)"/g,"LUUID('$1')"),b=b.replace(/"##ISODate\(([a-zA-Z0-9À-Üß-ü$-.:_@\/ ]*)\)"/g,"ISODate('$1')"),b=b.replace(/"##Timestamp\(([0-9,\s-]*)\)"/g,"Timestamp($1)"),b=A(b)},e=0,f=a.length;f>e;e++){var g,h=a[e];h&&(g=lxHelpers.isString(h._id)?p(h._id):h._id),c.push({id:g,data:d(K(h,b?b[g]:null))})}return c}function M(b,c,d){c=c||{},c.documents=c.documents||{},c.documents.data=b,c.documents.listDocuments=[],c.documents.textDocuments=[],c.documents.tableDocuments=[],c.documents.tableHeader=c.documents.tableHeader||[],c.selectedView===a.views[0].pathToHTMLFile&&(c.documents.listDocuments=I(b,d)),c.documents.textDocuments=L(b,d),c.selectedView===a.views[1].pathToHTMLFile&&(c.documents.tableHeader=H(b,c.isSelectedQueryParam!==c.selectedQueryParam||c.newQuery?[]:c.documents.tableHeader),c.documents.tableDocuments=J(b,d)),c.documents.dataAsJSON=[];for(var e=0,f=b.length;f>e;e++){var g,h={};h.data=JSON.stringify(b[e],null,"	"),b[e]&&(g=lxHelpers.isString(b[e]._id)?p(b[e]._id):b[e]._id),g&&(h.id=g),c.documents.dataAsJSON[e]=h}}function N(a){return lxHelpers.isObject(a)||lxHelpers.isArray(a)?Object.keys(a).length:0}function O(b,c,d){var e=null,f=0;return angular.forEach(a.tabControl,function(a){f++,a.connectionString===b&&a.db.name===c&&a.collectionName===d&&(e=a)}),f===a.tabControl.length?e:void 0}a.codeTheme={find:"mbo","map-reduce":"mbo",serversidescript:"mbo",mongoshell:"mbo"},a.views=i,a.documentView=i[0],a.setIsEnabled=!1,a.themeSelection=g,a.setCodemirroTheme=function(b,c){a.codeTheme[c]=b},a.connections=[],a.tabControl=[],a.sortParams=[{name:"asc",sorting:1},{name:"desc",sorting:-1}],a.typeStyles=l,a.$watch(function(a){return a.connections.map(function(a){return{connectionString:a.connectionString,color:a.color}})},function(b){angular.forEach(a.tabControl,function(a){b.length>0&&a.connectionString===b[0].connectionString&&(a.color=b[0].color)})},!0),c.emit("api/settings/getUserSettings",{},function(a,b){b&&u(b)}),c.emit(d+"main/getServerConnections",{},function(a,b){b=b||[];var c=lxHelpers.arrayFirst(b,function(a){return a.is_default_connection});c&&w({connection:c})}),c.on("mongoshell.stdout",function(b){if(b.data&&"string"==typeof b.data)for(var c=0;c<a.tabControl.length;c++)if(a.tabControl[c].mongoshell&&a.tabControl[c].mongoshell.pid===b.pid){var d=b.data.trim().split("\n");if(d.length>0)for(var e=0;e<d.length;e++){var f=d[e].trim();"{"===f.charAt(0)&&"}"===f.charAt(f.length-1)&&a.tabControl[c].mongoshell.griddata.push(o(f))}for(var g=0,h=0;-1!==(h=a.tabControl[c].mongoshell.history.indexOf("\n",h));)h++,g++;g>499&&(a.tabControl[c].mongoshell.history=""),a.tabControl[c].mongoshell.history+=b.data,setTimeout(function(){var a=document.getElementById("mongoshellconsole");a&&(a.scrollTop=999999)},50),M(a.tabControl[c].mongoshell.griddata,a.tabControl[c]);break}}),c.on("mongoshell.close",function(b){f("MONGOSHELL_CLOSED").then(function(a){h.bbcAlert.warning(a+(b.code?"\nExitcode "+b.code:""))});for(var c=0;c<a.tabControl.length;c++)if(a.tabControl[c].mongoshell&&a.tabControl[c].mongoshell.pid===b.pid){a.tabControl[c].mongoshell.pid=null,a.tabControl[c].mongoshell.history="",a.tabControl[c].mongoshell.griddata=[],a.tabControl[c].mongoshell.cmds.index=0,a.tabControl[c].mongoshell.cmds.list=[];break}}),c.on("mongoshell.error",function(a){f("MONGOSHELL_ERROR").then(function(b){h.bbcAlert.warning(b+(a.code?"\nErrorcode "+a.code:""))})}),c.on("mms.progress",function(a){h.progressInfo={isActive:!0,max:a.max,value:a.value,type:a.type,unit:a.unit}}),c.on("mms.export.done",function(b){if(a.$parent.isLoading=!1,h.progressInfo={},b){var c=document.getElementById("hiddenFileDownloader"),d="/export/"+b.fileName;c?c.src=d:m.open(d,"_blank","target=_blank,location=no,width=320,height=160")}}),c.on("mms.export.error",function(b){a.$parent.isLoading=!1,h.progressInfo={};var c="";b&&(c=b.errors&&b.errors[0]?f.instant(b.errors[0].message):b.message||b.toString(),e.open({id:"ErrorExportCollectionPopup",headline:f.instant("EXPORT_COLLECTION"),message:c,size:"sm",buttonTextValues:{ok:f.instant("OK")},callObj:function(){a.message="Collection is not exported"}}))}),c.on("mms.import.done",function(b){a.$parent.isLoading=!1,b.collectionName=a.collectionImport.collectionName,b.success=!0;var c=a.collectionImport.db;if(h.progressInfo={},b&&b.success)if(f("IMPORT_SUCCESS",{result:b.resultCount,origin:b.originCount}).then(function(a){h.bbcAlert.success(a)}),-1===c.collections.indexOf(b.collectionName)&&a.collectionImport.isBasedOnDbLevel)c.collections.push(b.collectionName),c.collections.sort(),a.openTabForSelectedCollection(a.collectionImport);else{var d=O(a.collectionImport.connection.connectionString,c.name,b.collectionName);d?(d.documents.$selectCount=0,d.documents.$isAllSelected=!1,d.documents.tableDocuments=void 0,a.getData(d)):a.openTabForSelectedCollection(a.collectionImport)}else f("ERROR_IMPORTING_COLLECTION",{errorMessage:b.error.message}).then(function(a){h.bbcAlert.danger(a)})}),c.on("mms.import.error",function(b){a.$parent.isLoading=!1,h.progressInfo={},f("MONGO_ERROR").then(function(a){h.bbcAlert.danger(a+": "+b.message)})}),a.setParameterForSelectedAllDocuments=function(a){lxHelpers.forEach(a.tableDocuments,function(b){b.$isSelected=a.$isAllSelected}),a.$selectCount=a.$isAllSelected?a.tableDocuments.length:0},a.setParameterForSelectionByDocument=function(a,b){a.$selectCount+=b.$isSelected?1:-1,a.$isAllSelected=a.$selectCount===a.tableDocuments.length},a.switchQueryParam=function(a,b){a.selectedQueryParam!==b&&(a.inputs[a.selectedQueryParam]=a.input,a.input=a.inputs[b]),"mongoshell"===b&&M(a.mongoshell.griddata||[],a)},a.expandPropertyInListView=function(a){if(a.isExpanded=!a.isExpanded,!a.properties)if(a.properties=[],a.isObjectID){var b=new Date(1e3*parseInt(JSON.parse('"'+p(a.value)+'"').toString().slice(0,8),16));a.properties.push({valueAsJSON:j.getFormattedDate(b,f.instant("DATETIME_FORMATS.OBJECTID")),title:b.toISOString(),key:"Datetime",style:y("date-time"),hasItems:!1})}else a.isCode?(a.properties.push({valueAsJSON:a.value.$code,key:"$code",style:y("Code"),hasItems:!1}),a.properties.push({valueAsJSON:a.value.$scope,value:a.value.$scope,key:"$scope",hasItems:!0})):a.properties=E(a.value,a.metadata)},a.switchDocumentView=function(b,c){b.documents=b.documents||{},c===a.views[0].pathToHTMLFile&&b.documents.listDocuments&&0===b.documents.listDocuments.length&&(b.documents.listDocuments=I(b.documents.data,b.metadata)),c===a.views[1].pathToHTMLFile&&b.documents.tableDocuments&&0===b.documents.tableDocuments.length&&(b.documents.tableHeader=H(b.documents.data),b.documents.tableDocuments=J(b.documents.data,b.metadata)),c===a.views[2].pathToHTMLFile&&b.documents.textDocuments&&0===b.documents.textDocuments.length&&(b.documents.textDocuments=L(b.documents.data,b.metadata))},a.isCollectionSystemCollection=function(a){return!!a.match(k)},a.showCollectionsFromDatabase=function(a,b){b.collections&&0!==b.collections.length?b.showCollections=!b.showCollections:c.emit(d+"main/getAllCollectionsNamesFromDatabase",{connectionString:a.connectionString,dbName:b.name,login_database:a.login_database,login:a.login,password:a.password},function(a,c){c?(b.collections=c,b.showCollections=!0):h.bbcAlert.danger(a.message)})},a.getData=function(b,d){if("serversidescript"===b.selectedQueryParam){var e={connectionString:b.connectionString,dbName:b.db.name,script:b.input||"",login_database:b.login_database,login:b.login,password:b.password};return void G(e,b)}if("mongoshell"===b.selectedQueryParam){var g={pid:b.mongoshell.pid,text:b.input||""};if(b.input&&-1===b.mongoshell.cmds.list.indexOf(b.input)){var i=b.mongoshell.cmds.list.push(b.input);b.mongoshell.cmds.index=i}return void c.emit("mongoshell.write",g,function(a,c){!a&&c||h.bbcAlert.danger(a.message||a||"Command could not be executed!"),b.mongoshell.griddata=[],b.isSelectedQueryParam="mongoshell",b.input=""})}b.newQuery=b.input!==b.executedInput||!b.documents.tableDocuments||d;var k=j.createQuery(b.input,b.selectedQueryParam);if(k.error)return void f("ERROR_PARSE_QUERY_OPTIONS").then(function(a){h.bbcAlert.danger(a)});b.pagingOptions=b.pagingOptions||{},b.pagingOptions.skip=b.pagingOptions.skip||0,b.pagingOptions.limit=b.pagingOptions.limit||a.defaultPageSize,d&&(b.pagingOptions=d);var l=k.options||{};l.limit&&(a.defaultPageSize=l.limit),l.skip=l.skip||b.pagingOptions.skip,l.limit=l.limit||b.pagingOptions.limit;var m={query:z(k.query),connectionString:b.connectionString,dbName:b.db.name,login_database:b.login_database,collectionName:b.collectionName,options:l,login:b.login,password:b.password};b.sortOptions&&0!==Object.keys(b.sortOptions).length&&b.selectedView===a.views[1].pathToHTMLFile?m.options.sort=b.sortOptions:(b.sortOptions={},b.sort=1,b.fieldSort=""),"find"===b.selectedQueryParam&&F(m,b)},a.sort=function(b,c,d){b.sortOptions={},b.selectedQueryParam="find",b.fieldSort&&c===b.fieldSort?(b.sort=1===d?-1:1,b.sortOptions[c]=1===d?-1:1):(b.sortOptions[c]=1,b.sort=1,b.fieldSort=c),a.getData(b)},a.openTabForSelectedCollection=function(b){var c=!1,d=j.getConnectionFullName(j.deleteOptionsFromConnectionString(b.connection.connectionString),b.db.name,b.collectionName);if(!b.isExtraTab)for(var e=0,f=a.tabControl.length;f>e;e++)if(a.tabControl[e].fullName===d){c=!0,a.tabControl[e].active="active";break}if(!c){var g={header:b.db.name+"."+b.collectionName,displayName:b.connection.displayName,fullName:d,title:j.getConnectionFullName(b.connection.replSetName||j.deleteOptionsFromConnectionString(b.connection.connectionString),b.db.name,b.collectionName),db:b.db,login_database:b.connection.login_database,collectionName:b.collectionName,connectionString:b.connection.connectionString,selectedView:a.documentView.pathToHTMLFile,input:"",executedInput:"",documents:{$selectCount:0},count:0,metadata:{},selectedQueryParam:"find",isSelectedQueryParam:"find",isGridFSCollection:j.isGridFSCollection(b.collectionName),fieldSort:"",sortOptions:{},pagingOptions:{},sort:1,active:"active",color:b.connection.color,inputs:{find:"",serversidescript:"",mongoshell:""},replSetName:b.connection.replSetName,newQuery:!0,master:b.connection.master,mongoshell:{pid:null,history:"",griddata:[],version:b.connection.mongoVersion||null,cmds:{index:0,list:[]}},isSlave:b.connection.isSlave,login:b.connection.login,password:b.connection.password};a.tabControl.push(g),a.getData(g)}},a.removeConnection=function(b){a.connections.splice(a.connections.indexOf(b),-1!==a.connections.indexOf(b)?1:0)},a.removeTab=function(b,c){var d;switch(c){case"single":a.closeMongoShell(a.tabControl[b]),a.tabControl.splice(b,1);break;case"all":for(d=0;d<a.tabControl.length;d++)a.closeMongoShell(a.tabControl[d]);a.tabControl=[];break;case"allOther":var e=a.tabControl[b];for(d=0;d<a.tabControl.length;d++)a.tabControl[d]!==e&&a.closeMongoShell(a.tabControl[d]);a.tabControl=[],a.tabControl.push(e)}},a.refreshConnection=function(a){var b={connectionString:a.connectionString,login_database:a.login_database,dbName:a.dbName,expandedDatabases:[],login:a.login,password:a.password};angular.forEach(a.databases,function(a){a.showCollections&&b.expandedDatabases.push(a.name)}),c.emit(d+"main/getDatabases",b,function(b,c){c?a.databases=c.databases:b&&f("ERROR_SERVER_CONNECTION",{errormessage:b.message}).then(function(a){h.bbcAlert.danger(a)})})},a.openModalToConnect=function(){function e(c){a.modalConnect=b.open({templateUrl:"app/main/dev/modals/connect/connect.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsConnectionCtrl",resolve:{item:function(){return{savedConnections:c,defaultMongoDbPort:a.defaultMongoDbPort}}}}),a.modalConnect.result.then(function(b){var d=!1;b.savedConnections=c;var e=b.connection.ssh_connectionString||b.connection.connectionString;a.connections.length>0&&angular.forEach(a.connections,function(a){j.deleteOptionsFromConnectionString(a.connectionString)===e&&a.displayName===b.connection.name&&(d=!0)}),d||w(b)},angular.noop)}c.emit(d+"main/getServerConnections",{},function(a,b){a?f("ERROR_SERVER_CONNECTION",{errormessage:a.message}).then(function(a){h.bbcAlert.danger(a)}):e(b||[])})},a.openModalToEdit=function(c,d){if(c&&!c.id)return void f("EDIT_DOCUMENT_NOID_ERROR").then(function(a){h.bbcAlert.danger(a)});var e=d.title.split("/")[0].match(":")?d.title.split("/")[0].replace(/:/,"_"):d.title.split("/")[0],g={json:d.json,fileName:e+"_"+d.db.name+"_"+d.collectionName,server:d.server,connectionString:d.connectionString,database:d.db.name,login_database:d.login_database,collection:d.collectionName,index:a.tabControl.indexOf(d),setIsEnabled:a.setIsEnabled,selectedQueryParam:d.selectedQueryParam,metadata:d.metadata,documents:d.documents.data,codeTheme:a.codeTheme,login:d.login,password:d.password};c?(g.id=c.id,g.data=c.data):(g.id=null,g.data="{}"),a.modalEdit=b.open({templateUrl:"app/main/dev/modals/document/edit.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsEditDocumentCtrl",resolve:{item:function(){return g}}}),a.modalEdit.result.then(function(){d.selectedQueryParam="find",d.documents.tableDocuments=void 0,a.getData(d)},angular.noop)},a.openModalToAddNewDatabase=function(c){a.modalNewDatabase=b.open({templateUrl:"app/main/dev/modals/db/new.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsNewDbCtrl",resolve:{item:function(){return c}}}),a.modalNewDatabase.result.then(function(a){c.databases.push({name:a.dbName,showCollections:!1}),c.databases.sort(v)},angular.noop)},a.openModalToRenameDatabase=function(c,d){var e=d.name,f={connection:c,dbName:e};a.modalRenameDatabase=b.open({templateUrl:"app/main/dev/modals/db/rename.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsRenameDbCtrl",resolve:{item:function(){return f}}}),a.modalRenameDatabase.result.then(function(b){angular.forEach(a.tabControl,function(a){a.connectionString===c.connectionString&&a.db.name===e&&(a.fullName=j.getConnectionFullName(j.deleteOptionsFromConnectionString(a.connectionString),b.dbName,a.collectionName),a.title=j.getConnectionFullName(j.deleteOptionsFromConnectionString(a.connectionString),b.dbName,a.collectionName),a.header=b.dbName+"."+a.collectionName)}),d.name=b.dbName,c.databases.sort(v)},angular.noop)},a.openModalToCopyDatabase=function(c,d){var e=d.name,f={connection:c,dbName:e};a.modalCopyDatabase=b.open({templateUrl:"app/main/dev/modals/db/copy.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsCopyDbCtrl",resolve:{item:function(){return f}}}),a.modalCopyDatabase.result.then(function(a){c.databases.push({name:a.dbName,showCollections:!1}),c.databases.sort(v)},angular.noop)},a.openModalToAddNewCollection=function(c,d){var e={connectionString:c.connectionString,db:d,login_database:c.login_database,displayName:c.displayName+"/"+d.name,mongoVersion:c.mongoVersion,newCollection:{name:null,capped:!1,autoIndexId:!0,max:0,size:0,usePowerOf2Sizes:"2.6."===c.mongoVersion?!0:void 0},login:c.login,password:c.password};a.modalNewCollection=b.open({templateUrl:"app/main/dev/modals/collection/new.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsNewCollectionCtrl",resolve:{item:function(){return e}}}),a.modalNewCollection.result.then(function(a){(j.isGridFSCollection(a.newCollection.name)||a.newCollection.isGridFSCollection)&&(a.newCollection.name=j.getNameOfFilesCollection(a.newCollection.name)),d.collections&&d.collections.length>0&&(d.collections.push(a.newCollection.name),d.collections.sort())},angular.noop)},a.openModalToCopyCollection=function(c,d,e){var f={connectionString:c.connectionString,db:d,displayName:j.getConnectionFullName(c.displayName,d.name),collectionName:e,login_database:c.login_database,defaultMongoDbPort:a.defaultMongoDbPort,master:c.master,login:c.login,password:c.password};a.modalCopyCollection=b.open({templateUrl:"app/main/dev/modals/collection/copy.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsCopyCollectionCtrl",resolve:{item:function(){return f}}}),a.modalCopyCollection.result.then(function(b){j.isGridFSCollection(e)&&(b.destinationCollectionName=j.getNameOfFilesCollection(b.destinationCollectionName)),d.collections&&d.collections.length>0&&"sameDbSameServer"===b.selectedOption&&(d.collections.push(b.destinationCollectionName),d.collections.sort()),"sameDbSameServer"!==b.selectedOption&&angular.forEach(a.connections,function(a){a.connectionString===b.destinationConnectionString&&angular.forEach(a.databases,function(a){a.name===b.destinationDbName&&a.collections&&a.collections.length>0&&(a.collections.push(b.destinationCollectionName),a.collections.sort())})})},angular.noop)},a.openModalToRenameCollection=function(c,d,e){var f={connectionString:c.connectionString,db:d,displayName:j.getConnectionFullName(c.displayName,d.name),oldCollectionName:e,login_database:c.login_database,login:c.login,password:c.password};a.modalRenameCollection=b.open({templateUrl:"app/main/dev/modals/collection/rename.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsRenameCollectionCtrl",resolve:{item:function(){return f}}}),a.modalRenameCollection.result.then(function(b){function f(a,b){var c=a.split(".");return j.isGridFSCollection(b)?c[c.length-2]=b.split(".")[0]:c[c.length-1]=b,c.join(".")}j.isGridFSCollection(e)&&(b.collectionName=j.getNameOfFilesCollection(b.collectionName)),angular.forEach(a.tabControl,function(a){a.connectionString===c.connectionString&&a.db.name===d.name&&a.collectionName===e&&(a.collectionName=b.collectionName,a.header=f(a.header,b.collectionName),a.fullName=f(a.fullName,b.collectionName),a.displayName=f(a.displayName,b.collectionName),a.title=f(a.title,b.collectionName))}),d.collections&&d.collections.length>0&&(d.collections[d.collections.indexOf(e)]=b.collectionName,d.collections.sort())},angular.noop)},a.openModalToEditAndAddIndexes=function(e,g,i){var k={displayName:j.getConnectionFullName(e.displayName,g),connectionString:e.connectionString,dbName:g,collectionName:i,login_database:e.login_database,login:e.login,password:e.password},l=function(){a.modalEditIndex=b.open({templateUrl:"app/main/dev/modals/collection/editIndexes.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsIndexEditCtrl",resolve:{item:function(){return k}}})};c.emit(d+"main/getCollectionIndexes",k,function(a,b){b?(k.indexes=b,k.replSetName=e.replSetName,l()):f("ERROR_GET_INDEXES_OF_COLLECTION").then(function(a){h.bbcAlert.danger(a)})})},a.dropDatabase=function(b,g){e.open({id:"ConfirmDeletingDatabasePopup",headline:f.instant("DROP_DB"),message:f.instant("DROP_DB_WARNING",{
db:g.name}),size:"sm",buttonTextValues:{yes:f.instant("YES"),no:f.instant("NO")},callObj:{cbYes:function(){c.emit(d+"main/dropDatabase",{connectionString:b.connectionString,dbName:g.name,login_database:b.login_database,login:b.login,password:b.password},function(c,d){if(d){var e=[],i=j.deleteOptionsFromConnectionString(b.connectionString),k=i+"/"+g.name;angular.forEach(a.tabControl,function(a){j.getConnectionFullName(i,a.db.name)!==k&&e.push(a)}),a.tabControl.length!==e.length&&(a.tabControl=e),b.databases.splice(b.databases.indexOf(g),1)}else f("ERROR_DELETING_DB",{errorMessage:c.message}).then(function(a){h.bbcAlert.danger(a)})})},cbNo:angular.noop}})},a.dropCollection=function(b,g,i){var k={connectionString:b.connectionString,dbName:g.name,collectionName:i,login_database:b.login_database,login:b.login,password:b.password};e.open({id:"ConfirmDeletingCollectionPopup",headline:f.instant("DROP_COLLECTION"),message:f.instant("DROP_COLLECTION_WARNING",{collection:i}),size:"sm",buttonTextValues:{yes:f.instant("YES"),no:f.instant("NO")},callObj:{cbYes:function(){c.emit(d+"main/dropCollection",k,function(c,d){if(d){var e=[],k=j.deleteOptionsFromConnectionString(b.connectionString),l=j.getConnectionFullName(k,g.name,i);angular.forEach(a.tabControl,function(a){a.fullName!==l&&e.push(a)}),a.tabControl.length!==e.length&&(a.tabControl=e),g.collections&&g.collections.splice(g.collections.indexOf(i),1)}else c&&f("ERROR_DELETING_COLLECTION",{errorMessage:c.message}).then(function(a){h.bbcAlert.danger(a)})})},cbNo:angular.noop}})},a.openModalToExportCollection=function(g,i,j){var k={connectionString:g.connectionString,dbName:i.name,collectionName:j,input:g.input,options:g.pagingOptions,displayName:g.displayName+"/"+i.name,login_database:g.login_database,selectedQueryParam:g.selectedQueryParam,login:g.login,password:g.password},l=window.io.sockets[window.location.origin];l&&l.sessionid&&(k.socketid=l.sessionid),k.options?a.modalExportCollection=b.open({templateUrl:"app/main/dev/modals/collection/export.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsExportCollectionCtrl",resolve:{item:function(){return k}}}):(k.query="{}",k.options={},h.progressInfo={},c.emit(d+"main/exportCollection",k,function(b){b?e.open({id:"ErrorExportCollectionPopup",headline:f.instant("EXPORT_COLLECTION"),message:"'"+b.message+"'\n"+f.instant("ERROR_EXPORT_COLLECTION"),size:"sm",buttonTextValues:{ok:f.instant("OK")},callObj:function(){a.message="Collection is not exported"}}):a.$parent.isLoading=!0}))},a.openModalToImportCollection=function(e,g,i,k){function l(){a.modalImportCollection=b.open({templateUrl:"app/main/dev/modals/collection/import.html",backdrop:!1,modalFade:!0,controller:"MainDevModalsImportCollectionCtrl",resolve:{item:function(){return m}}}),a.modalImportCollection.result.then(function(b){b&&b.error?f("ERROR_IMPORTING_COLLECTION",{errorMessage:b.error.message}).then(function(a){h.bbcAlert.danger(a)}):a.collectionImport=b},angular.noop)}var m={connection:{displayName:j.getConnectionFullName(e.displayName,g.name),connectionString:e.connectionString,color:e.color,replSetName:e.replSetName,master:e.master},db:g,collectionName:k,isBasedOnDbLevel:i,login_database:e.login_database,login:e.login,password:e.password};m.db.collections&&0!==m.db.collections.length?l():c.emit(d+"main/getAllCollectionsNamesFromDatabase",{connectionString:m.connection.connectionString,dbName:m.db.name,login_database:m.login_database,login:e.login,password:e.password},function(a,b){b?(m.db.collections=b,l()):h.bbcAlert.danger(a.message)})},a.editSettings=function(){a.modalEditSettings=b.open({backdrop:!1,modalFade:!0,controller:"MainDevModalsSettingsCtrl",keyboard:!1,templateUrl:"app/main/dev/modals/settings/settings.html"}),a.modalEditSettings.result.then(function(a){u(a)},angular.noop)},a.deleteSelectedDocument=function(b,g){var i=[];if(0!==g.documents.$selectCount&&g.selectedView===a.views[1].pathToHTMLFile)lxHelpers.forEach(g.documents.tableDocuments,function(a){if(a.$isSelected){var b={id:a.id,metadata:g.metadata[a.id]._id};i.push(b)}});else{var j={id:b,metadata:g.metadata[b]._id};i.push(j)}e.open({id:"ConfirmDeletingDocumentPopup",headline:f.instant("DELETE_DOCUMENT"),message:f.instant("DELETE_DOCUMENT_WARNING"),size:"sm",buttonTextValues:{yes:f.instant("YES"),no:f.instant("NO")},callObj:{cbYes:function(){var b={connectionString:g.connectionString,dbName:g.db.name,collectionName:g.collectionName,documentsIds:i,login_database:g.login_database,login:g.login,password:g.password};c.emit(d+"main/deleteDocument",b,function(b,c){c?(g.documents.$selectCount=0,g.documents.$isAllSelected=!1,g.documents.tableDocuments=void 0,f("DELETE_SUCCESS",{result:c,origin:i.length}).then(function(a){h.bbcAlert.success(a)}),a.getData(g)):b&&b.message?h.bbcAlert.danger(b.message):f("DELETE_DOCUMENT_ERROR").then(function(a){h.bbcAlert.danger(a)})})},cbNo:angular.noop}})},a.downloadFile=function(a,b){var c={connectionString:b.connectionString,dbName:b.db.name,collection:b.collectionName.split(".")[0],login_database:b.login_database,fileid:a},d=document.getElementById("hiddenFileDownloader"),e="/download/"+btoa(JSON.stringify(c));d?d.src=e:m.open(e,"_blank","target=_blank,location=no,width=320,height=160")},a.repairDatabase=function(a,b){c.emit(d+"main/repairDatabase",{connectionString:a.connectionString,dbName:b.name,login_database:a.login_database,login:a.login,password:a.password},function(a,b){b?f("REPAIR_SUCCESS").then(function(a){h.bbcAlert.success(a)}):h.bbcAlert.danger(a.message)})},a.openMongoShell=function(b){var d={connectionstring:j.deleteOptionsFromConnectionString(b.connectionString),database:b.db.name||"",mongoversion:b.mongoshell.version,login:b.login,password:b.password};c.emit("mongoshell.spawn",d,function(c,d){c&&(a.item.error=c.message||c),b.mongoshell.pid=d.pid,b.mongoshell.history=""})},a.closeMongoShell=function(a){if(a.mongoshell&&a.mongoshell.pid){var b={mongoshellpid:a.mongoshell.pid||0};c.emit("mongoshell.kill",b,function(b,c){!b&&c||h.bbcAlert.danger(b.message||b||"MongoShell could not be terminated!"),a.mongoshell.pid=null,a.mongoshell.history="",a.mongoshell.cmds.index=0,a.mongoshell.cmds.list=[]})}},a.showSelectCommandFromList=function(a){a.input=a.mongoshell.cmds.list[a.mongoshell.cmds.index]||""}}]),angular.module("main.dev.modals",["main.dev.modals.connect","main.dev.modals.db.new","main.dev.modals.db.copy","main.dev.modals.db.rename","main.dev.modals.collection.new","main.dev.modals.collection.editIndexes","main.dev.modals.collection.copy","main.dev.modals.collection.rename","main.dev.modals.settings","main.dev.modals.document.edit","main.dev.modals.collection.export","main.dev.modals.collection.import"]),angular.module("main.dev.modals.collection.copy",["common.settings","common.utils"]).controller("MainDevModalsCopyCollectionCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","$rootScope","mmsUtils",function(a,b,c,d,e,f,g,h){a.model={displayName:e.displayName,collectionName:e.collectionName,selectedOption:"sameDbSameServer"},a.ok=function(){var g=!1,i=!0,j=!0,k={connectionString:e.connectionString,destinationConnectionString:e.connectionString,dbName:e.db.name,login_database:e.login_database,destinationDbName:e.db.name,collectionName:e.collectionName,destinationCollectionName:e.collectionName,selectedOption:a.model.selectedOption,master:e.master.server+":"+e.master.port,login:e.login,password:e.password,destination_login:e.login,destination_password:e.password};a.model.destinationServer&&(k.destinationConnectionString=h.addPortToConnectionString(a.model.destinationServer,e.defaultMongoDbPort)),"sameDbSameServer"===a.model.selectedOption?(k.destinationCollectionName=a.model.destinationCollectionName,k.destination_login_database=a.model.login_database||e.login_database,i=h.isValidCollectionName(k.destinationCollectionName),g=(e.db.collections||[]).indexOf(a.model.destinationCollectionName)>-1):(k.destinationDbName=a.model.destinationDbName,k.destination_login=a.model.destination_login,k.destination_password=a.model.destination_password,j=h.isValidDbName(a.model.destinationDbName),k.destination_login&&k.destination_password&&(k.destination_login_database=k.destination_login_database||k.destinationDbName)),!g&&i&&j?b.rest(c+"main/copyCollection",k,function(b,c){c?d.close(k):a.model.error=b.message}):"sameDbSameServer"===a.model.selectedOption?a.model.error=g?f.instant("COLLECTION_ALREADY_EXISTS",{collection:a.model.destinationCollectionName}):f.instant("COLLECTION_INCORRECT_NAME"):a.model.error=f.instant("DB_INCORRECT_NAME")},a.cancel=function(){g.isLoading=!1,d.dismiss("cancel")}}]),angular.module("main.dev.modals.collection.editIndexes",[]).controller("MainDevModalsIndexEditCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","$bbcForm","$bbcModal","mmsUtils",function(a,b,c,d,e,f,g,h,i){a.showSettings=!1,a.indexData=e,a.showElementsToEdit=!1;var j=function(a){var b;return b=a.replace(/\t"/g,"	").replace(/":/g,":"),b=b.replace(/([a-zA-Z0-9-._: ]+)"/g,'"$1"').replace(/""/g,'"').replace(/,"/g,","),b=b.replace(/"([a-zA-Z0-9-._: ]+):/g,"$1:"),b=b.replace(/"/g,"'")},k=function(a){var b;return b=a.replace(/:/g,"':").replace(/([a-zA-Z0-9-._: ]+)':/g,"'$1':").replace(/'/g,'"'),b.replace(/\s/g,"")};a.openFormToEdit=function(b){b.keyString=b.key?j(JSON.stringify(b.key,null,"	")):"",b.weigthsString=b.weights?j(JSON.stringify(b.weights,null,"	")):"",b.nameOfIndex=b.name||void 0,a.lxForm=g(),a.lxForm.setModel(angular.copy(b)),a.showElementsToEdit=!0},a.closeForm=function(){a.showElementsToEdit=!1,a.indexData.error=null,a.lxForm.reset()},a.dropIndexOfCollection=function(d){h.open({id:"ConfirmDeletingSelectedIndexPopup",headline:f.instant("DROP_INDEX"),message:f.instant("DROP_INDEX_WARNING",{collection:e.collectionName}),buttonTextValues:{yes:f.instant("YES"),no:f.instant("NO")},callObj:{cbYes:function(){var f={connectionString:e.connectionString,dbName:e.dbName,collectionName:e.collectionName,nameOfIndex:d.name,refreshIndexes:!0,login_database:e.login_database,login:e.login,password:e.password};b.emit(c+"main/dropIndex",f,function(b,c){b?a.indexData.error=b.message:c&&angular.forEach(a.indexData.indexes,function(b){f.nameOfIndex===b.name&&a.indexData.indexes.splice(a.indexData.indexes.indexOf(b),1)})})},cbNo:angular.noop}})},a.save=function(){var d=a.lxForm.model.name===a.lxForm.model.nameOfIndex?!1:i.nameExistsInArray(a.indexData.indexes,a.lxForm.model.name);if(!d&&a.indexData.indexes.length<64)try{a.lxForm.model.key=JSON.parse(k(i.addCurlyBraces(a.lxForm.model.keyString)));try{a.lxForm.model.weigthsString&&(a.lxForm.model.weights=JSON.parse(k(i.addCurlyBraces(a.lxForm.model.weigthsString))));var g=angular.copy(a.lxForm.model),h={connectionString:e.connectionString,dbName:e.dbName,collectionName:e.collectionName,nameOfIndex:g.nameOfIndex,index:{key:g.key,options:{name:g.name||void 0,unique:g.unique||void 0,dropDups:g.dropDups||void 0,sparse:g.sparse||void 0,expireAfterSeconds:angular.isNumber(g.expireAfterSeconds)?g.expireAfterSeconds:void 0,background:g.background||void 0,default_language:g.default_language||void 0,language_override:g.language_override||void 0,weights:g.weights||void 0},isNew:g.newIndex},login_database:e.login_database,login:e.login,password:e.password};b.emit(c+"main/setIndexToCollection",h,function(b,c){b?a.indexData.error=b.errors?b.errors[0].property+": "+b.errors[0].message:b.message:c&&(a.indexData.indexes=c.indexList,a.showElementsToEdit=!1,a.lxForm.reset())})}catch(j){a.lxForm.model.$weightError=j.message}}catch(j){a.lxForm.model.$keyError=j.message}else a.indexData.error=d?f.instant("INDEX_ALREADY_EXISTS",{indexName:a.lxForm.model.name}):f.instant("MAX_LENGTH_OF_INDEXES")},a.dropAllIndexesOfCollection=function(){h.open({id:"ConfirmDeletingAllIndexesPopup",headline:f.instant("DROP_ALL_INDEXES"),message:f.instant("DROP_ALL_INDEXES_WARNING",{collection:e.collection}),buttonTextValues:{yes:f.instant("YES"),no:f.instant("NO")},callObj:{cbYes:function(){var d={connectionString:e.connectionString,dbName:e.dbName,collectionName:e.collectionName,login_database:e.login_database,login:e.login,password:e.password};b.emit(c+"main/dropAllIndexesOfCollection",d,function(b,c){b?a.indexData.error=b.message:c&&(a.indexData.indexes.splice(1,a.indexData.indexes.length-1),a.showElementsToEdit&&a.openFormToEdit({newIndex:!0}))})},cbNo:angular.noop}})},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.collection.export",[]).controller("MainDevModalsExportCollectionCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils","$window","$rootScope",function(a,b,c,d,e,f,g,h,i){function j(a){var b="{}";if(a){b=a.replace(/\s/g,"");var c=b.lastIndexOf("},{"),d=-1!==c?b.substring(0,c+1):b;b=g.addCurlyBraces(d)}return b}a.collection=e,a.collection.exportType=e.input&&""!==e.input?"currentQuery":"all","find"!==a.collection.selectedQueryParam&&(a.collection.exportType="all"),i.progressInfo={},a.collection.queryToDisplay=j(e.input),a.collection.queryToDisplayWithPager=a.collection.queryToDisplay+", skip:"+e.options.skip+", limit:"+e.options.limit;var k=g.createQuery(e.input,"find");k.error&&f("ERROR_PARSE_QUERY_OPTIONS").then(function(b){a.collection.error=b}),a.ok=function(){k.options=k.options||{},"currentView"===a.collection.exportType&&(k.options.skip=e.options.skip,k.options.limit=e.options.limit);var g={query:"all"!==a.collection.exportType?k.query:"{}",connectionString:e.connectionString,dbName:e.dbName,collectionName:e.collectionName,options:"all"!==a.collection.exportType?k.options:null,login_database:e.login_database,socketid:e.socketid||void 0,login:e.login,password:e.password};b.emit(c+"main/exportCollection",g,function(b){b?f("MONGO_ERROR").then(function(c){a.collection.error=c+": "+b.message}):(a.$parent.isLoading=!0,d.close())})},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.collection.import",[]).controller("MainDevModalsImportCollectionCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","$http","mmsUtils","$rootScope",function(a,b,c,d,e,f,g,h,i){a.collection=e,a.collection.collectionName=a.collection.isBasedOnDbLevel?"":a.collection.collectionName,a.collection.collectionNameError=void 0,a.files=[],a.title=f.instant("IMPORT_COLLECTION_MODAL_TITLE",{collection:a.collection.collectionName}),a.collection.selectedOption="fileUpload",a.collection.isDropDuplicateKeys=!0,a.collection.uploadOptionToInsert="merge",a.collection.textDocuments="",a.counterFileSizeIncorrect=0,i.progressInfo={},a.$watch("collection.collectionName",function(){a.collection.uploadOptionToInsert=-1===a.collection.db.collections.indexOf(a.collection.collectionName)?"merge":a.collection.uploadOptionToInsert});var j=function(g){var h={connectionString:a.collection.connection.connectionString,dbName:a.collection.db.name,collectionName:a.collection.collectionName,uploadOptionToInsert:a.collection.uploadOptionToInsert,selectedOption:a.collection.selectedOption,content:g,login_database:a.collection.login_database,isDropDuplicateKeys:a.collection.isDropDuplicateKeys,login:e.login,password:e.password},i=window.io.sockets[window.location.origin];i&&i.sessionid&&(h.socketid=i.sessionid);var j="replace"===a.collection.uploadOptionToInsert?"importCollectionReplace":"importCollectionAppend";b.emit(c+"main/"+j,h,function(b){b?f("MONGO_ERROR").then(function(c){a.collection.textDocumentsError=c+": "+b.message}):(a.$parent.isLoading=!0,d.close(e))})},k=function(b){a.$parent.isLoading=!0,g({method:"POST",url:"/import",withCredentials:!0,headers:{"Content-Type":void 0},data:b,transformRequest:angular.identity}).then(function(b){a.$parent.isLoading=!1,i.progressInfo={},b.data.error?d.close(b.data):(a.$parent.isLoading=!0,d.close(e))})},l=function(){var b;if("textDocuments"===a.collection.selectedOption)if(0!==a.collection.textDocuments.length){b=h.addSquareBrackets(h.replacerOfDocumentsForServer(a.collection.textDocuments));try{b=JSON.parse(b),j(b)}catch(c){f("ERROR_PARSE_IMPORT_TEXT_FIELD").then(function(b){a.collection.textDocumentsError=b})}}else f("ERROR_EMPTY_IMPORT").then(function(b){a.collection.textDocumentsError=b});else if("fileUpload"===a.collection.selectedOption)if(0!==a.files.length){var d=new FormData;d.append("connectionString",a.collection.connection.connectionString),d.append("dbName",a.collection.db.name),d.append("collectionName",a.collection.collectionName),d.append("uploadOptionToInsert",a.collection.uploadOptionToInsert),d.append("selectedOption",a.collection.selectedOption),d.append("isDropDuplicateKeys",a.collection.isDropDuplicateKeys);var e=window.io.sockets[window.location.origin];e&&e.sessionid&&d.append("socketid",e.sessionid),a.collection.login_database&&d.append("login_database",a.collection.login_database),d.append("content",a.files[0]),k(d)}else f("ERROR_EMPTY_IMPORT").then(function(b){a.collection.emptyFileError=b})};a.addFirstFile=function(b){b instanceof Array&&b.length>0&&(b[0].size>1048e5&&a.counterFileSizeIncorrect++,a.files.push(b[0])),b instanceof FileList&&b.length>0&&a.files.push(b[0])},a.setFiles=function(b){a.$apply(function(){a.addFirstFile(b.files)})},a.removeFileFromList=function(b){a.files[b].size>1048e5&&a.counterFileSizeIncorrect--,a.files.splice(b,1)},a.ok=function(){a.collection.isBasedOnDbLevel?h.isValidCollectionName(a.collection.collectionName)?l():f("COLLECTION_INCORRECT_NAME").then(function(b){a.collection.collectionNameError=b}):l()},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.collection.new",[]).controller("MainDevModalsNewCollectionCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils",function(a,b,c,d,e,f,g){a.model={newCollection:e.newCollection,displayName:e.displayName,mongoVersion:e.mongoVersion},a.$watch("model.newCollection.isGridFSCollection",function(){a.model.newCollection.isGridFSCollection?a.model.newCollection.name=g.getNameOfFilesCollection(a.model.newCollection.name):a.model.newCollection.name=(a.model.newCollection.name||"").split(".")[0]}),a.ok=function(){var h=(e.db.collections||[]).indexOf(a.model.newCollection.name)>-1;if(!h&&g.isValidCollectionName(a.model.newCollection.name)){var i={connectionString:e.connectionString,dbName:e.db.name,login_database:e.login_database,newCollection:a.model.newCollection,login:e.login,password:e.password};b.emit(c+"main/createCollection",i,function(b,c){c?d.close(a.model):b&&(a.model.error=b.errors?b.errors[0].property+": "+b.errors[0].message:b.message)})}else a.model.error=h?f.instant("COLLECTION_ALREADY_EXISTS",{collection:a.model.newCollection.name}):f.instant("COLLECTION_INCORRECT_NAME")},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.collection.rename",[]).controller("MainDevModalsRenameCollectionCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils",function(a,b,c,d,e,f,g){a.model={displayName:e.displayName,oldCollectionName:e.oldCollectionName},a.ok=function(){var h=(e.db.collections||[]).indexOf(a.model.collectionName)>-1;if(!h&&g.isValidCollectionName(a.model.collectionName)){var i={connectionString:e.connectionString,dbName:e.db.name,oldCollectionName:e.oldCollectionName,collectionName:a.model.collectionName,login_database:e.login_database,login:e.login,password:e.password};b.emit(c+"main/renameCollection",i,function(b,c){c?d.close(a.model):a.model.error=b.message})}else a.model.error=h?f.instant("COLLECTION_ALREADY_EXISTS",{collection:a.model.collectionName}):f.instant("COLLECTION_INCORRECT_NAME")},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.connect",[]).controller("MainDevModalsConnectionCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","$document","mmsUtils","$bbcForm",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return!lxHelpers.arrayHasItem(c,function(c){return c.connectionString===a&&c.name===b})}function k(){a.lxForm&&a.lxForm.model&&a.lxForm.model.is_default_connection===!0&&angular.forEach(a.item.savedConnections,function(b){b.connectionString!==a.lxForm.model.connectionString&&(b.is_default_connection=!1)})}function l(){a.item.error=null,k(),b.emit(c+"main/changeServerConnections",{connections:a.item.savedConnections},function(b){b?b.errors?(angular.forEach(b.errors,function(a){h.normalizeValidationErrors(a)}),a.lxForm.populateValidation(a.lxForm,b.errors)):a.item.error=b:a.isConnectionToAddOrEdit=!1})}function m(a,b){k(),a.connectionString=h.addPortToConnectionString(a.connectionString,e.defaultMongoDbPort),d.close({connection:a,isNewConnection:!!b})}a.sortField="name",a.sortOption=!1,a.item={savedConnections:e.savedConnections},a.isConnectionToAddOrEdit=!1,a.isNewConnection=!0,a.openFormToEditOrAddConnection=function(b,c){b.color=c?h.getColorForTab((e.savedConnections||[]).length):b.color,a.isNewConnection=c,a.isConnectionToAddOrEdit=!0,a.lxForm=i("connections"),a.lxForm.setModel(b)},a.deleteSelectedConnection=function(b){var c=a.item.savedConnections.indexOf(b);a.item.savedConnections.splice(c,1),l()},a.cloneSelectedConnection=function(b){var c=lxHelpers.clone(b);c.name+=" copy",c.color=h.getColorForTab((e.savedConnections||[]).length),a.isNewConnection=!0,a.isConnectionToAddOrEdit=!0,a.lxForm=i("connections"),a.lxForm.setModel(c)},a.closeForm=function(){var b=a.item.savedConnections.indexOf(a.lxForm.model);a.isConnectionToAddOrEdit=!1,a.lxForm.reset(),a.item.savedConnections[b]=a.lxForm.model},a.connectToExistingServer=function(a){m(a)},a.ok=function(){if(a.isNewConnection){var b=a.lxForm.model;m(b,j(b.connectionString,b.name,a.item.savedConnections))}else l()},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.db.copy",[]).controller("MainDevModalsCopyDbCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils",function(a,b,c,d,e,f,g){a.model={serverName:e.connection.displayName,oldDbName:e.dbName},a.ok=function(){var h=g.nameExistsInArray(e.connection.databases,a.model.dbName);if(!h&&g.isValidDbName(a.model.dbName)){var i={connectionString:e.connection.connectionString,master:e.connection.master,oldDbName:e.dbName,newDbName:a.model.dbName,login_database:e.connection.login_database,login:e.login,password:e.password};b.emit(c+"main/copyDatabase",i,function(b,c){c?d.close(a.model):b.message?a.model.error=b.message:f("ERROR_EDIT_DATABASE").then(function(b){a.model.error=b})})}else a.model.error=h?f.instant("DB_ALREADY_EXISTS",{db:a.model.dbName}):f.instant("DB_INCORRECT_NAME")},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.db.new",[]).controller("MainDevModalsNewDbCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils",function(a,b,c,d,e,f,g){a.model={serverName:e.displayName},a.ok=function(){var h=g.nameExistsInArray(e.databases,a.model.dbName);!h&&g.isValidDbName(a.model.dbName)?b.emit(c+"main/createDatabase",{connectionString:e.connectionString,dbName:a.model.dbName,login_database:e.login_database,login:e.login,password:e.password},function(b){b?b.message?a.model.error=b.message:f("DB_NEW_SERVER_ERROR").then(function(b){a.model.error=b}):d.close(a.model)}):a.model.error=h?f.instant("DB_ALREADY_EXISTS",{db:a.model.dbName}):f.instant("DB_INCORRECT_NAME")},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.db.rename",[]).controller("MainDevModalsRenameDbCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils",function(a,b,c,d,e,f,g){a.model={serverName:e.connection.displayName,oldDbName:e.dbName},a.ok=function(){var h=g.nameExistsInArray(e.connection.databases,a.model.dbName);if(!h&&g.isValidDbName(a.model.dbName)){var i={connectionString:e.connection.connectionString,master:e.connection.master,dbName:e.dbName,newDbName:a.model.dbName,login_database:e.connection.login_database,login:e.connection.login,password:e.connection.password};b.emit(c+"main/renameDatabase",i,function(b,c){c?d.close(a.model):a.model.error=b.message})}else a.model.error=h?f.instant("DB_ALREADY_EXISTS",{db:a.model.dbName}):f.instant("DB_INCORRECT_NAME")},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.document.edit",[]).controller("MainDevModalsEditDocumentCtrl",["$scope","$bbcTransport","MAIN_DEVELOPER_MODULEPATH","$modalInstance","item","$translate","mmsUtils",function(a,b,c,d,e,f,g){var h=function(a){var b;return b=a.replace(/"##ObjectId\(\\"([a-z0-9]*)\\"\)"/g,"ObjectId('$1')"),b=b.replace(/"##ISODate\(([a-zA-Z0-9À-Üß-ü$-.:_@\/ ]*)\)"/g,"ISODate('$1')")};a.item=e,a.item.document=h(e.data);var i=function(e){var h={connectionString:e.connectionString,dbName:e.database,collectionName:e.collection,login_database:a.item.login_database,id:e.id,setIsEnabled:e.setIsEnabled,metadata:e.metadata[e.id],login:a.item.login,password:a.item.password};a.item.error=[];try{h.data=JSON.parse(g.replacerOfDocumentsForServer(g.addCurlyBraces(e.document))),b.emit(c+"main/saveDocument",h,function(b,c){c?c.name&&"ValidationError"===c.name?c.errors.forEach(function(b){a.item.error.push('Property "'+b.property+'" (actual type: '+b.actual+") "+b.message)}):d.close(a.item):(b||0===c)&&f("MONGO_ERROR").then(function(c){a.item.error.push(c+": "+(b?b.message:f.instant("ERROR_UPDATE_EMPTY_RESULT")))})})}catch(i){a.item.error.push("Parse error: "+i.message+" Please check if your data contains strings with escaped characters (like \\d)")}};a.ok=function(){i(a.item)},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("main.dev.modals.settings",[]).controller("MainDevModalsSettingsCtrl",["$scope","$bbcTransport","$modalInstance","$bbcForm","LANGUAGES","THEMES","VIEWS","PAGESIZES",function(a,b,c,d,e,f,g,h){a.lxForm=d("settings","_id"),a.languages=e,a.themes=f,a.views=g,a.pageSizes=h,a.item={},b.emit("api/settings/getUserSettings",{},function(b,c){b?a.item.error=b.message:c&&a.lxForm.setModel(c)}),a.save=function(){b.emit("api/settings/setUserSettings",a.lxForm.model,function(b){b?a.item.error=b:c.close(a.lxForm.model)})},a.cancel=function(){c&&c.dismiss("cancel")}}]),angular.module("common.focus",[]).directive("lxFocus",["$timeout",function(a){return{link:function(b,c,d){d.$observe("lxFocus",function(d){var e=b.$eval(d);e===!0&&a(function(){c[0].focus()})})}}}]),angular.module("common.fileDrop",[]).directive("fileDropzone",function(){return{restrict:"A",scope:{fileitems:"=",fileid:"=",handle:"&"},link:function(a,b){var c=function(a){return null!==a&&a.preventDefault(),a.dataTransfer.effectAllowed="all",!1};return b.bind("dragover",c),b.bind("dragenter",c),b.bind("drop",function(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer.files;return c.length>0&&(a.$apply(function(){a.fileitems=[];for(var b=0;b<c.length&&(a.fileitems.push(c[b]),!a.fileid);b++);return a}),a.$apply("handle()")),!1})}}}),angular.module("common.settings",[]).constant("MAIN_DEVELOPER_MODULEPATH","api/app/main/").constant("REGEX_DB_NAME",/[À-Üß-ü$\s\. \/"*<>:\|\?\x00\\]/g).constant("REGEX_COLLECTION_NAME",/[À-Üß-ü$\/"*<>:\|\?\x00\\]/g).constant("REGEX_SYSTEM_COLLECTION_NAMES",/system\./).constant("REGEX_SYSTEM_AND_CHUNKS_COLLECTION_NAMES",/system\.|\.chunks/).constant("COLORS",["#ff4800","#6ac76a","#3f91f7","#ffe345","#dd3ed0","#CDC0B0","#458B74","#FFE4C4","#8A2BE2","#0000CD","#EE3B3B","#458B00","#FF7F24","#6495ED","#DC143C","#FFB90F","#6E8B3D","#9A32CD","#00CED1","#2F4F4F","#F08080"]).constant("PAGESIZES",[1,5,10,15,20,25,50,100,250,500]).constant("DEFAULT_PAGE_SIZE",50).constant("LANGUAGES",[{name:"ENGLISH",code:"en-us",flagURL:"assets/images/noRename/flag-jamaica.png"},{name:"GERMAN",code:"de-de",flagURL:"assets/images/noRename/Germany-Flag-icon.png"},{name:"CHINESE",code:"zh-cn",flagURL:"assets/images/noRename/China.png"},{name:"SPANISH",code:"es-es",flagURL:"assets/images/noRename/Argentina.png"},{name:"TURKISH",code:"tr-tr",flagURL:"assets/images/noRename/Turkey.png"},{name:"ITALIAN",code:"it-it",flagURL:"assets/images/noRename/Italy.png"},{name:"DANISH",code:"da-dk",flagURL:"assets/images/noRename/Denmark.png"},{name:"RUSSIAN",code:"ru-ru",flagURL:"assets/images/noRename/Russia.png"}]).constant("VIEWS",[{name:"LIST_VIEW",cssClass:"glyphicon glyphicon-align-left icons-view-select",pathToHTMLFile:"app/main/dev/tpls/listdocuments.html"},{name:"TABLE_VIEW",cssClass:"glyphicon glyphicon-list icons-view-select",pathToHTMLFile:"app/main/dev/tpls/tabledocuments.html"},{name:"TEXT_VIEW",cssClass:"glyphicon glyphicon-file icons-view-select",pathToHTMLFile:"app/main/dev/tpls/textdocuments.html"}]).constant("TYPE_STYLES",{type_object:{image:"glyphicon glyphicon-sound-stereo",color:"#2B2B2B",fontStyle:"normal"},type_array:{image:"glyphicon glyphicon-sound-dolby",color:"#2B2B2B",fontStyle:"normal"},type_string:{image:"glyphicon glyphicon-subtitles",color:"#619647",fontStyle:"normal"},type_objectId:{image:"glyphicon glyphicon-unchecked",color:"#D25252",fontStyle:"normal"},type_date_time:{image:"glyphicon glyphicon-calendar",color:"#9876AA",fontStyle:"normal"},type_number:{image:"glyphicon glyphicon-sound-5-1",color:"#6897BB",fontStyle:"normal",align:"right"},type_null:{image:"glyphicon glyphicon-stop",color:"#808080",fontStyle:"italic"},type_boolean:{image:"glyphicon glyphicon-random",color:"#CB772F",fontStyle:"italic"},type_regex:{image:"glyphicon glyphicon-pause",color:"#283997",fontStyle:"normal"},type_uuid:{image:"glyphicon glyphicon-pause",color:"#E89B9B",fontStyle:"normal"},type_luuid:{image:"glyphicon glyphicon-pause",color:"#6A1E1E",fontStyle:"normal"},type_timestamp:{image:"glyphicon glyphicon-pause",color:"#72617C",fontStyle:"normal"},type_dbref:{image:"glyphicon glyphicon-pause",color:"#9A9E6B",fontStyle:"normal"},type_code:{image:"glyphicon glyphicon-pause",color:"#CB772F",fontStyle:"normal"},type_minkey:{image:"glyphicon glyphicon-pause",color:"#CEBE75",fontStyle:"normal"},type_maxkey:{image:"glyphicon glyphicon-pause",color:"#CEBE75",fontStyle:"normal"}}).constant("THEMES",["3024-day","3024-night","ambiance","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","midnight","monokai","neat","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized","the-matrix","tomorrow-night-eighties","twillight","vibrant-ink","xq-dark","xq-light"]),angular.module("common.utils",["common.settings"]).factory("mmsUtils",["REGEX_DB_NAME","REGEX_SYSTEM_COLLECTION_NAMES","REGEX_COLLECTION_NAME","COLORS","$filter",function(a,b,c,d,e){function f(a){var b;return b=a.replace(/\r|\n/g,""),b=b.replace(/\t/g,""),b=b.replace(/([\{,]+)([\s]*)([a-zA-Z0-9À-Üß-ü$\-\/\._ ]+):/g,'$1$2$3":'),b=b.replace(/([\{,]+)([\s]*)([a-zA-Z0-9À-Üß-ü$\-\/\._]+)([a-zA-Z0-9À-Üß-ü$\-\/\._ ]*)":/g,'$1$2"$3$4":'),b=b.replace(/([\[,:]+)([\s]*)ISODate\("/g,'$1$2"##ISODate(').replace(/([\[,:]+)([\s]*)"##ISODate\(([a-zA-Z0-9À-Üß-ü$\-\/\._:, ]+)"\)/g,'$1$2"##ISODate($3)"'),b=b.replace(/([\[,:]+)([\s]*)ISODate\('/g,'$1$2"##ISODate(').replace(/([\[,:]+)([\s]*)"##ISODate\(([a-zA-Z0-9À-Üß-ü$\-\/\._:, ]+)'\)/g,'$1$2"##ISODate($3)"'),b=b.replace(/ObjectId\("([a-z0-9-]+)"\)/g,'"##ObjectId($1)"'),b=b.replace(/:([\s]*)\/([a-zA-Z0-9À-Üß-ü$\^+\*-\\\._'()\/ ]*)":([a-zA-Z0-9À-Üß-ü$\^+\*-\\\._'()\/ ]*)\//g,":$1/$2:$3/"),b=b.replace(/:([\s]*)\/([a-zA-Z0-9À-Üß-ü$\^+\*-\\\._:'()\/ ]+)\/([a-z]*)/g,':$1"##/$2/$3"'),b=b.replace(/'/g,'"'),b=b.replace(/"([\s]*)_id([\s]*)"/g,'"_id"'),b=b.replace(/([\s]*)\$/g,"$"),b=b.replace(/"([$a-zA-Z]+)([\s]*)"/g,'"$1"'),b=b.replace(/:([ ]*){/g,":{")}var g={};return g.nameExistsInArray=function(a,b){var c,d=a.length,e=!1;for(c=0;d>c;c++){var f=a[c].name||a[c];if(f===b){e=!0;break}}return e},g.isValidDbName=function(c){return c&&!c.match(a)&&-1===c.search(b)},g.isValidCollectionName=function(a){return a&&!a.match(c)&&-1===a.search(b)},g.getColorForTab=function(a){
return a<d.length?d[a]:d[0]},g.deleteOptionsFromConnectionString=function(a){return-1===a.lastIndexOf("?")?a:a.slice(0,a.lastIndexOf("?"))},g.getConnectionFullName=function(a,b,c){return c?a+"/"+b+"."+c:a+"/"+b},g.prepareDataForJSONParse=function(a){return a=a.replace(/\{/g,'{"'),a=a.replace(/:/g,'":'),a=a.replace(/,/g,',"'),a=a.replace(/,"'/g,',"'),a=a.replace(/,""/g,',"'),a=a.replace(/,"{/g,",{"),a=a.replace(/'/g,'"')},g.addCurlyBraces=function(a){return"[]"===a?"{[]}":("{"!==a[0]&&"["!==a[0]&&(a="{"+a),"{"===a[0]&&a.split("{").length!==a.split("}").length&&(a+="}"),a)},g.numberOfOpenAndClosedCurlyBracesAreTheSame=function(a){a=g.addCurlyBraces(a),"}"!==a[a.length-1]&&(a+="}");var b=a.match(/{/g)||[],c=a.match(/}/g)||[];return b.length===c.length},g.addSquareBrackets=function(a){return"["!==a[0]&&(a="["+a),"["===a[0]&&a.split("[").length!==a.split("]").length&&(a+="]"),a},g.addPortToConnectionString=function(a,b){b=b||27017;var c=a.split(","),d=[];return angular.forEach(c,function(a){var c=a.split("@"),e=c[1]||c[0],f=e.split(":");a=1===f.length?a+":"+b:a,d.push(a)}),d.join(",")},g.getFormattedDate=function(a,b){return angular.isDate(a)?(b=b||"short",e("date")(a,b)):null},g.isGridFSCollection=function(a){return-1!==a.indexOf(".files",a.length-6)},g.getNameOfFilesCollection=function(a){return g.isGridFSCollection(a)?a:a+".files"},g.replacerOfDocumentsForServer=function(a){var b;b=a.replace(/([\{,]+)([\s]*)([a-zA-Z0-9À-Üß-ü$\-\/\._"']+)([\s]+):/g,"$1$2$3:"),b=b.replace(/([\[,:]+)([\s]*)ISODate\("/g,'$1$2"##ISODate(').replace(/([A-Z0-9-]+)":([0-9]+)":([A-Z0-9.]+)/g,"$1:$2:$3").replace(/([\[,:]+)([\s]*)"##ISODate\(([a-zA-Z0-9À-Üß-ü$\-\/\._:, ]*)"\)/g,'$1$2"##ISODate($3)"'),b=b.replace(/([\[,:]+)([\s]*)ISODate\('/g,'$1$2"##ISODate(').replace(/([A-Z0-9-]+)":([0-9]+)":([A-Z0-9.]+)/g,"$1:$2:$3").replace(/([\[,:]+)([\s]*)"##ISODate\(([a-zA-Z0-9À-Üß-ü$\-\/\._:, ]*)'\)/g,'$1$2"##ISODate($3)"'),b=b.replace(/([\[,:]+)([\s]*)ISODate\(\)/g,'$1$2"##ISODate()"'),b=b.replace(/:([\s]*)"([a-zA-Z0-9À-Üß-ü$\-\/\._, ]+)":/g,':$1"$2:');var c=b;return b=b.replace(/":([\s]*)\/([a-zA-Z0-9À-Üß-ü$\^+*\-\\\.\/_:'()| ]+)\/([im]*)/g,'":$1"##/$2/$3"'),c!==b&&(b=b.replace(/(##\/)(.*?)\\([SsvdDBwW]+)/g,"$1$2\\\\$3")),b=b.replace(/([,\[]+)([\s]*)\/([a-zA-Z0-9À-Üß-ü$\^+*\-\\\.\/_:'()| ]+)\/([im]*)/g,'$1$2"##/$3/$4"'),b=b.replace(/([\[,:]+)([\s]*)ObjectId\('([a-z0-9]+)'\)/g,'$1$2"##ObjectId($3)"').replace(/([\[,:]+)([\s]*)ObjectId\("([a-z0-9]+)"\)/g,'$1$2"##ObjectId($3)"'),b=b.replace(/([\[,:]+)([\s]*)UUID\('([a-z0-9-]+)'\)/g,'$1$2"##UUID($3)"').replace(/([\[,:]+)([\s]*)UUID\("([a-z0-9-]+)"\)/g,'$1$2"##UUID($3)"'),b=b.replace(/([\[,:]+)([\s]*)LUUID\('([a-z0-9-]+)'\)/g,'$1$2"##LUUID($3)"').replace(/([\[,:]+)([\s]*)LUUID\("([a-z0-9-]+)"\)/g,'$1$2"##LUUID($3)"'),b=b.replace(/([\[,:]+)([\s]*)Timestamp\(([0-9,\s-]+)\)/g,'$1$2"##Timestamp($3)"').replace(/([\[,:]+)([\s]*)Timestamp\(([0-9,\s-]+)\)/g,'$1$2"##Timestamp($3)"'),b=b.replace(/:([\s]*)'([a-zA-Z0-9À-Üß-ü$\-\/\._:' ]+)'([\s]*)([,}]+)/g,':$1"$2"$3$4').replace(/"":/g,'":').replace(/:([\s]*)""([a-zA-Z0-9À-Üß-ü$\-\/\._ ]+)/g,':$1"$2')},g.removeComments=function(a){var b="_"+ +new Date,c=[],d=0;return a.replace(/(['"])(\\\1|.)+?\1/g,function(a){return c[d]=a,b+""+d++}).replace(/([^\/])(\/(?!\*|\/)(\\\/|.)+?\/[gim]{0,3})/g,function(a,e,f){return c[d]=f,e+(b+"")+d++}).replace(/\/\/.*?\/?\*.+?(?=\n|\r|$)|\/\*[\s\S]*?\/\/[\s\S]*?\*\//g,"").replace(/\/\/.+?(?=\n|\r|$)|\/\*[\s\S]+?\*\//g,"").replace(new RegExp("\\/\\*[\\s\\S]+"+b+"\\d+","g"),"").replace(new RegExp(b+"(\\d+)","g"),function(a,b){return c[b]})},g.normalizeValidationErrors=function(a){a.property.indexOf(".")>-1&&(a.property=a.property.split(".")[1])},g.createOptionsForQuery=function(a){return a=a.replace(/\r|\n/g,""),a=g.addCurlyBraces(a),a=f(a),a.replace(/""/g,'"')},g.createQuery=function(a,b){var c,d,e,f={query:"{}"};if(a)if(a=g.removeComments(a),f.query=a.replace(/\r|\n/g,""),f.query=f.query.replace(/}([\s]*),([\s]*){/g,"},{"),f.query=f.query.replace(/,([\s]*)"/g,',"'),f.query=f.query.replace(/{([\s]*)"/g,'{"'),f.query=f.query.replace(/"([\s]*),/g,'",'),f.query=f.query.replace(/"([\s]*):/g,'":'),f.query=f.query.replace(/"([\s]*)}/g,'"}'),f.query=f.query.replace(/:([\s]*)"/g,':"'),f.query=f.query.replace(/([\s]*)\[/g,"["),f.query=f.query.replace(/{([\s]*)/g,"{"),f.query=f.query.replace(/([\s]*)}/g,"}"),f.query=f.query.replace(/}([\s]*)/g,"}"),f.query=f.query.replace(/([\s]*){/g,"{"),f.query=f.query.replace(/'/g,'"'),"aggregate"!==b&&f.query.indexOf("},{")>0)if(c=f.query.lastIndexOf("},{"),e=f.query.substring(0,c+1),d=f.query.substring(c+2),g.numberOfOpenAndClosedCurlyBracesAreTheSame(d)){f.query=g.addCurlyBraces(e),f.options=g.createOptionsForQuery(d);try{f.options=JSON.parse(f.options)}catch(h){f.error="ERROR_PARSE_QUERY_OPTIONS"}}else f.query=g.addCurlyBraces(f.query);else if("aggregate"===b){var i=f.query;if(c=i.lastIndexOf("],{"),i.lastIndexOf("],{")>-1){e=i.substring(0,c+1),d=i.substring(c+2),f.query=g.addCurlyBraces(e),f.options=g.createOptionsForQuery(d);try{f.options=JSON.parse(f.options)}catch(h){f.error="ERROR_PARSE_QUERY_OPTIONS"}}else f.query=g.addCurlyBraces(i)}else f.query=g.addCurlyBraces(f.query);return f},g}]),angular.module("common.codemirror.directives",[]).directive("lxCodemirror",["$timeout",function(a){return{restrict:"A",transclude:!0,require:"ngModel",replace:!0,scope:{ngModel:"=",lxTheme:"=",lxCodemirrorVisible:"=",lxCodemirrorMode:"=",id:"@",action:"&"},link:function(b,c){CodeMirror.defineOption("lxCodemirrorMode","find");var d=CodeMirror.fromTextArea(c[0],{theme:"mbo",lineWrapping:!0,lineNumbers:!0,mode:"javascript",indentWithTabs:!0,smartIndent:!1});d.addKeyMap({"Cmd-Enter":function(){b.action&&b.action()},"Ctrl-Enter":function(){b.action&&b.action()}});var e=c.next();e.hasClass("CodeMirror")&&(e.css({height:"36px"}),d.setValue(b.ngModel),a(function(){d.refresh()},100)),b.$watch("lxCodemirrorMode",function(a){a&&d.setOption("lxCodemirrorMode",a)}),b.$watch("lxTheme",function(a){a&&d.setOption("theme",a)});var f=!1;b.$watch("ngModel",function(){b.ngModel!==d.getValue()&&(f=!0,d.setValue(b.ngModel));var a=angular.element(c).next(),e=a[0].getElementsByClassName("CodeMirror-code"),g=angular.element(e[0]).children()[0],h=36;g&&(h=g.getBoundingClientRect().height*d.lineCount()),36>h+8?a.css({height:"36px"}):a.css({height:h+8+"px"})}),d.on("change",function(){b.$$phase||f?f=!1:b.$apply(function(){b.ngModel=d.getValue()})}),b.$watch("lxCodemirrorVisible",function(a){void 0!==a&&a&&d.refresh()})}}}]),angular.module("common.codemirror",["common.codemirror.directives"]),angular.module("common.contextmenu.directives",[]).directive("lxContextmenu",["$parse","$window",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){var a=document.getElementsByClassName("dropdown-menu");angular.forEach(a,function(a){angular.element(a).hasClass("context-menu")&&angular.element(a).css({display:"none"})})}var g=a(e.lgRightclick);d.bind("contextmenu",function(a){f();var e=d.next(),h=d[0].getBoundingClientRect();c.$apply(function(){a.preventDefault(),g(c,{$event:a}),angular.element(e).css({display:"block",top:h.top+"px",left:a.pageX-20+"px"});var d=b.innerHeight-(e[0].getBoundingClientRect().height+e[0].getBoundingClientRect().top+30),i=b.innerWidth-(e[0].getBoundingClientRect().width+e[0].getBoundingClientRect().left+20);0>d&&angular.element(e).css({top:h.top-Math.abs(d)+"px"}),0>i&&angular.element(e).css({left:a.pageX-Math.abs(i)+20+"px"}),e.bind("mouseleave",function(){f(),e.unbind("mouseleave")})})})}}}]),angular.module("common.contextmenu",["common.contextmenu.directives"]),angular.module("common.scrollframe.directives",[]).directive("lxScrollframe",["$window","$timeout",function(a){return{restrict:"A",scope:{lxScrollframe:"=",lxScrollframeWidth:"=",lxScrollframeMirrorVisible:"=",lxScrollframeRepaint:"="},link:function(b,c){function d(){var d=c.next(),e=0;d.hasClass("panel-footer")&&(e=d[0].getBoundingClientRect().height);var f=a.innerHeight-(c[0].getBoundingClientRect().top+e+30);angular.element(c).css({maxHeight:f+"px",minHeight:f+"px"}),b.lxScrollframeWidth=c[0].getBoundingClientRect().width}angular.element(a).bind("resize",function(){d()}),b.$watch("lxScrollframeRepaint",function(){setTimeout(function(){d()},10)}),b.$watch("lxScrollframe",function(a){a&&d()}),b.$watch("lxScrollframeMirrorVisible",function(){d()}),d()}}}]),angular.module("common.scrollframe",["common.scrollframe.directives"]);